local toolchainlib = require("../lune_packages/core")
local fs = require("@lune/fs")

return function(version)
	local exit_code = toolchainlib("red-blox/zap", "bins/zap", { "bins/zap/tests/input.zap" })
	assert(exit_code == 0, `shouldnt error`)

	local client_signature = `\n-- Client generated by Zap v{version} (https://github.com/red-blox/zap)`
	assert(fs.readFile("bins/zap/tests/output/client.luau"):find(client_signature, 1, true), `invalid client output`)

	local server_signature = `\n-- Server generated by Zap v{version} (https://github.com/red-blox/zap)`
	assert(fs.readFile("bins/zap/tests/output/server.luau"):find(server_signature, 1, true), `invalid server output`)
end
